// @ts-nocheck
  (function() {
  'use strict';
  
  "use strict";var __SurfaceAnalytics=(()=>{var u=Object.defineProperty,U=Object.defineProperties,L=Object.getOwnPropertyDescriptor,N=Object.getOwnPropertyDescriptors,O=Object.getOwnPropertyNames,T=Object.getOwnPropertySymbols;var k=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var y=(r,e,t)=>e in r?u(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,_=(r,e)=>{for(var t in e||(e={}))k.call(e,t)&&y(r,t,e[t]);if(T)for(var t of T(e))H.call(e,t)&&y(r,t,e[t]);return r},b=(r,e)=>U(r,N(e));var q=(r,e)=>{for(var t in e)u(r,t,{get:e[t],enumerable:!0})},F=(r,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of O(e))!k.call(r,n)&&n!==t&&u(r,n,{get:()=>e[n],enumerable:!(i=L(e,n))||i.enumerable});return r};var R=r=>F(u({},"__esModule",{value:!0}),r);var s=(r,e,t)=>y(r,typeof e!="symbol"?e+"":e,t);var B={};q(B,{Analytics:()=>f,CONFIG:()=>l});var l={VERSION:"1.0.0",API_ENDPOINT:"/api/analytics/ingest",BATCH_SIZE:10,FLUSH_INTERVAL:5e3,MAX_QUEUE_SIZE:100,COOKIE_DURATION:365};var d=class{constructor(){s(this,"visitorId",null)}getVisitorId(){if(this.visitorId)return this.visitorId;if(this.visitorId=this.getFromStorage(),!this.visitorId){let e=this.generateFingerprint();this.visitorId=`vis_${this.generateUUID()}_${e}`,this.setVisitorId(this.visitorId)}return this.visitorId}getFromStorage(){try{let e=localStorage.getItem("surface_visitor_id");if(e)return e}catch(e){}return this.getCookie("surface_visitor_id")}setVisitorId(e){this.visitorId=e;try{localStorage.setItem("surface_visitor_id",e)}catch(t){}this.setCookie("surface_visitor_id",e,365)}generateFingerprint(){let e=[navigator.userAgent,navigator.language,`${screen.width}x${screen.height}`,screen.colorDepth.toString(),new Date().getTimezoneOffset().toString(),String(!!window.sessionStorage),String(!!window.localStorage),(navigator.hardwareConcurrency||0).toString(),(navigator.maxTouchPoints||0).toString()];return this.simpleHash(e.join("|")).substring(0,12)}generateUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)})}simpleHash(e){let t=5381;for(let i=0;i<e.length;i++)t=(t<<5)+t+e.charCodeAt(i);return Math.abs(t).toString(36)}getCookie(e){var n,a;let i=`; ${document.cookie}`.split(`; ${e}=`);return i.length===2&&(a=(n=i.pop())==null?void 0:n.split(";").shift())!=null?a:null}setCookie(e,t,i){let n=new Date;n.setTime(n.getTime()+i*24*60*60*1e3);let a=`expires=${n.toUTCString()}`;document.cookie=`${e}=${t};${a};path=/;SameSite=Lax`}};var p=class{constructor(){s(this,"sessionId",null)}getSessionId(){if(this.sessionId)return this.sessionId;try{this.sessionId=sessionStorage.getItem("surface_session_id"),this.sessionId||(this.sessionId=`sess_${this.generateUUID()}`,sessionStorage.setItem("surface_session_id",this.sessionId))}catch(e){this.sessionId=`sess_${this.generateUUID()}`}return this.sessionId}getUserId(){try{return localStorage.getItem("surface_user_id")}catch(e){return null}}setUserId(e){try{localStorage.setItem("surface_user_id",e)}catch(t){}}generateUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)})}};var v=class{send(e){this.sendWithBeacon(e)||this.sendWithFetch(e)}sendWithBeacon(e){if(!navigator.sendBeacon)return!1;try{let t=new Blob([JSON.stringify(e)],{type:"application/json"});return navigator.sendBeacon(l.API_ENDPOINT,t)}catch(t){return console.error("Surface Analytics: Beacon send failed",t),!1}}sendWithFetch(e){fetch(l.API_ENDPOINT,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),keepalive:!0}).catch(t=>{console.error("Surface Analytics: Fetch send failed",t)})}};var g=class{constructor(e,t){this.apiKey=e;s(this,"queue",[]);s(this,"flushTimer",null);s(this,"transport");this.transport=t||new v,this.setupFlushInterval(),this.setupUnloadHandlers()}enqueue(e){this.queue.push(e),(this.queue.length>=l.BATCH_SIZE||this.queue.length>=l.MAX_QUEUE_SIZE)&&this.flush()}flush(){if(this.queue.length===0)return;let e=[...this.queue];this.queue=[];let t={api_key:this.apiKey,events:e,batch_id:this.generateUUID(),sent_at:new Date().toISOString()};this.transport.send(t)}setupFlushInterval(){this.flushTimer=window.setInterval(()=>{this.queue.length>0&&this.flush()},l.FLUSH_INTERVAL)}setupUnloadHandlers(){let e=()=>this.flush();window.addEventListener("beforeunload",e),window.addEventListener("pagehide",e),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&this.flush()})}generateUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)})}destroy(){this.flushTimer&&clearInterval(this.flushTimer)}};var m=class{constructor(){s(this,"handler",null)}setup(e){this.handler=e,document.addEventListener("click",this.handleClick.bind(this),!0)}handleClick(e){var t;if(this.handler)try{let i=e.target,n=(t=i.tagName)==null?void 0:t.toLowerCase();if(!(n==="button"||n==="a"||n==="input"&&["submit","button"].includes(i.type)||i.getAttribute("role")==="button"||i.hasAttribute("data-track-surface")))return;let c={event:"click",properties:{element_id:i.id||null,element_tag:n,element_classes:Array.from(i.classList||[]),element_text:this.getElementText(i),element_href:i.href||null,element_type:i.type||null,element_name:i.name||null,element_path:this.getElementPath(i),page_url:window.location.href,viewport_x:e.clientX,viewport_y:e.clientY,page_x:e.pageX,page_y:e.pageY}};this.handler(c)}catch(i){console.error("Surface Analytics: Click tracking error",i)}}getElementText(e){return(e.innerText||e.textContent||"").trim().substring(0,100)}getElementPath(e){let t=[],i=e;for(;i&&i!==document.body&&t.length<5;){let n=i.tagName.toLowerCase();if(i.id){n+=`#${i.id}`,t.unshift(n);break}else if(i.className){let a=Array.from(i.classList).slice(0,2).join(".");a&&(n+=`.${a}`)}t.unshift(n),i=i.parentElement}return t.join(" > ")}};var x=class{constructor(){s(this,"handler",null)}setup(e){this.handler=e,document.addEventListener("blur",this.handleBlur.bind(this),!0)}async handleBlur(e){var t,i,n,a,c,h,E,I,w,S;if(this.handler)try{let o=e.target;if((o.type==="email"||((t=o.name)==null?void 0:t.toLowerCase().includes("email"))||((i=o.id)==null?void 0:i.toLowerCase().includes("email"))||((n=o.placeholder)==null?void 0:n.toLowerCase().includes("email")))&&o.value){let A=o.value.trim().toLowerCase();if(this.isValidEmail(A)){let C={event:"email_entered",properties:{email_hash:await this.hashEmail(A),field_id:(a=o.id)!=null?a:null,field_name:(c=o.name)!=null?c:null,field_type:(h=o.type)!=null?h:null,page_url:window.location.href,form_id:(I=(E=o.form)==null?void 0:E.id)!=null?I:null,form_name:(S=(w=o.form)==null?void 0:w.name)!=null?S:null}};this.handler(C)}}}catch(o){console.error("Surface Analytics: Email tracking error",o)}}isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}async hashEmail(e){var t;try{if((t=window.crypto)!=null&&t.subtle){let n=new TextEncoder().encode(e),a=await window.crypto.subtle.digest("SHA-256",n);return Array.from(new Uint8Array(a)).map(h=>h.toString(16).padStart(2,"0")).join("")}}catch(i){}return this.simpleHash(e)}simpleHash(e){let t=5381;for(let i=0;i<e.length;i++)t=(t<<5)+t+e.charCodeAt(i);return Math.abs(t).toString(36)}};var f=class{constructor(){s(this,"initialized",!1);s(this,"SNIPPET_VERSION");s(this,"visitorId","");s(this,"_writeKey",null);s(this,"visitor");s(this,"session");s(this,"queue",null);s(this,"clickTracker");s(this,"emailTracker");s(this,"readyCallbacks",[]);s(this,"isReady",!1);this.SNIPPET_VERSION="1.0.0",this._writeKey=null,this.visitor=new d,this.session=new p,this.clickTracker=new m,this.emailTracker=new x}load(e){if(this.initialized){console.warn("Surface Analytics: Already initialized");return}let t=e!=null?e:this._writeKey;if(!t){console.error("Surface Analytics: No API key provided");return}this._writeKey=t,this.initialized=!0,this.visitorId=this.visitor.getVisitorId(),this.queue=new g(t),this.trackScriptInit(),this.setupAutoTracking(),this.isReady=!0,this.executeReadyCallbacks(),console.log("Surface Analytics initialized with key:",t)}page(e){let t={event:"page_view",properties:_({page_url:window.location.href,page_title:document.title,referrer:document.referrer||"direct",path:window.location.pathname,search:window.location.search,hash:window.location.hash},e)};this.enqueue(t)}track(e,t){if(!e||typeof e!="string"){console.error("Surface Analytics: Event name must be a string");return}let i={event:e,properties:t!=null?t:{}};this.enqueue(i)}identify(e,t){let i={event:"identify",properties:{user_id:e,traits:t!=null?t:{}}};this.session.setUserId(e),this.enqueue(i)}ready(e){typeof e=="function"&&(this.isReady?e():this.readyCallbacks.push(e))}trackScriptInit(){let e={event:"script_init",properties:{snippet_version:this.SNIPPET_VERSION,script_version:l.VERSION,page_url:window.location.href,page_title:document.title,referrer:document.referrer||"direct",user_agent:navigator.userAgent,screen_resolution:`${screen.width}x${screen.height}`,viewport_size:`${window.innerWidth}x${window.innerHeight}`,color_depth:screen.colorDepth,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,timezone_offset:new Date().getTimezoneOffset(),language:navigator.language,platform:navigator.platform,cookie_enabled:navigator.cookieEnabled,online:navigator.onLine}};this.enqueue(e)}setupAutoTracking(){this.page(),this.clickTracker.setup(e=>this.enqueue(e)),this.emailTracker.setup(e=>this.enqueue(e))}enqueue(e){var i;if(!this.queue)return;let t=b(_({},e),{visitor_id:this.visitorId,user_id:this.session.getUserId(),session_id:this.session.getSessionId(),timestamp:new Date().toISOString(),api_key:(i=this._writeKey)!=null?i:void 0,page_url:window.location.href,page_title:document.title});this.queue.enqueue(t)}executeReadyCallbacks(){this.readyCallbacks.forEach(e=>{try{e()}catch(t){console.error("Surface Analytics: Ready callback error",t)}}),this.readyCallbacks=[]}};return R(B);})();

  
  // Create analytics instance
  const analytics = new __SurfaceAnalytics.Analytics();
  
  // Handle stub queue from snippet (surface array)
  if (window.surface && Array.isArray(window.surface)) {
    const stub = window.surface;
    
    // Process existing events in queue
    stub.forEach((item) => {
      if (item.event === 'surface.js') {
        console.log('Surface Analytics: Snippet loaded at', new Date(item['surface.start']));
      }
    });
  }
  
  // Expose analytics globally
  window.surface = analytics;
  window.analytics = analytics;
  
  // API key placeholder - will be replaced by /tag.js route
  const SURFACE_API_KEY = null;
  
  // Auto-initialize if API key is present
  if (SURFACE_API_KEY) {
    analytics.load(SURFACE_API_KEY);
  } else {
    console.warn('Surface Analytics: No API key found. Script should be loaded via /tag.js?id=YOUR_API_KEY');
  }
})();